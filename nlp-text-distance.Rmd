---
layout: page
title: "데이터 사이언스 - 자연어 처리"
subtitle: "텍스트 거리"
author:
    name: xwMOOC
date: "`r Sys.Date()`"
output:
  html_document: 
    toc: yes
    toc_float: true
    highlight: tango
    code_folding: show
    number_section: true
    self_contained: true
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning=FALSE,
                      comment="", digits = 3, tidy = FALSE, prompt = FALSE, fig.align = 'center')

# library(reticulate)
# use_condaenv("anaconda3")
# reticulate::repl_python()
```


# 문자열 거리 [^levenshtein-korean] [^stringdist] [^stringdist-matching] {#text-distance}

[^levenshtein-korean]: [LOVIT x DATA SCIENCE (2018-08-28), "Levenshtein (edit) distance 를 이용한 한국어 단어의 형태적 유사성"](https://lovit.github.io/nlp/2018/08/28/levenshtein_hangle/)

[^stringdist]: [Joy of data (2013/08/21), "Comparison of String Distance Algorithms"](https://www.joyofdata.de/blog/comparison-of-string-distance-algorithms/)

[^stringdist-matching]: [Mark P.J. van der Loo (2014), "The stringdist Package for Approximate
String Matching", RJournal 6 111-122](https://cran.r-project.org/web/packages/stringdist/vignettes/RJournal_6_111-122-2014.pdf)

단어 혹은 문장의 거리를 파악할 때 많이 사용되는 것이 **레빈스타인 편집 거리(levenshtein edit distance)**다. 영화와 애니메이션은 다른 것과 비교하여 의미론적으로 유사하지만 형태적 유사성은 거의 없다. 의미론적 유사성을 따지는데 도움이 되는 것이 `Word2Vec`이라면 형태론적 유사성을 따지는 대표적인 것이 레빈스타인 편집 거리(levenshtein edit distance)다. 

영어와 한글의 유사성을 따지는데 차이가 있기 때문에 영어를 대상으로 먼저 형태론적 유사성을 따져보자. [`stringdist`](https://github.com/markvanderloo/stringdist) 팩키지에 문자열 거리와 관련된 대부분의 기능이 구현되어 있다.

[`stringdist`](https://github.com/markvanderloo/stringdist) 팩키지의 철학은 Base R의 다양한 함수 `match`, `adist`, `nchar`, `agrep` 등을 포괄하는 인터페이스를 목적으로 제작되었다.

* `stringdist`: 두 입력 문자열 벡터 사이 거리 계산
* `stringdistmatrix`: 하나 혹은 두개 벡터에 대한 거리 행렬 계산
* `stringsim`: `stringdist`에 기반하여 0과 1 사이 문자열 유사도 계산
* `amatch`: R 내장 `match` 함수에 대응되는 퍼지 매칭
* `ain`: R 내장 `%in%` 연산자에 대응되는 퍼지 매칭
* `seq_dist`, `seq_distmatrix`, `seq_amatch`, `seq_ain`: 정수 순열에 매칭되는 거리 ([hashr](https://github.com/markvanderloo/hashr)팩키지 참조).

## 사전 찾기 {#dictionary-lookup}

가장 먼저 사전 찾기(dictionary lookup)을 사례로 들어본다. Base R에 포함된 문자열 찾기 관련 함수를 사례로 들어본다.

```{r levenshtein-distance}
library(stringdist)

match("leia", c("leela","leia"))

match("liea", c("leela","leia"))

amatch("liea", c("leela","leia"), maxDist=1)

"liea" %in% c("leela","leia")

ain("liea", c("leela","leia"), maxDist=1)
```


## 거리계산 {#calculate-string-distance}

문자열 `s`가 문자열 `t`로 변환시키는데 필요한 최소 연산수를 계산하는 다양한 알고리즘이 존재한다.
많이 사용되는 알고리즘은 치환(substitution), 삭제(deletion), 삽입(insertion), 전치(transposition) 지원여부에 따라 다양한 알고리즘이 지원된다.

```{r webshot2-stringdist}
library(magick)

edit_pdf <- image_read_pdf("data/stringdistuser2014-140704113415-phpapp01.pdf", pages=13)

edit_pdf %>% 
  image_crop(geometry="1350x400+100+350")
```

앞서 언급된 알고리즘은 `stringdist` 팩키지에 구현되어 있다.

```{r stringdist-kramer}
library(tidyverse)

string_df <- tribble(~"typing",
    "Cosmo Kramer",
    "Kosmo Kramer",
    "Comso Kramer",
    "Csmo Kramer",
    "Cosmo X. Kramer",
    "Kramer, Cosmo",
    "Jerry Seinfeld",
    " CKaemmoorrs",
    "Cosmer Kramo",
    "Kosmoo Karme",
    "George Costanza",
    "Elaine Benes",
    "Dr. Van Nostren",
    "remarK omsoC",
    "Mr. Kramer",
    "Sir Cosmo Kramer",
    "C.o.s.m.o. .K.r.a.m.e.r",
    "CsoKae",
    "Coso Kraer")
 
string_df <- string_df %>% 
  mutate(name = "Cosmo Kramer") %>% 
  mutate(lv_dist = map2_dbl(typing, name, stringdist, "lv"),
         osa_dist = map2_dbl(typing, name, stringdist, "osa"),
         dl_dist = map2_dbl(typing, name, stringdist, "dl"),
         jw_dist = map2_dbl(typing, name, stringdist, "jw"),
         ham_dist = map2_dbl(typing, name, stringdist, "hamming"))

string_df
```


## `ngram` 거리 {#calculate-ngram-distance}

`qgrams()` 함수의 문자열 쪼개는 것을 `q=2`로 변화를 주어 차이나는 것을 확인하고 거리도 계산할 수 있다.

```{r ngram-distance}
answer <- "Mariah"
query  <- "Marya"

carey <- qgrams(answer, query, q=2)

carey
```

<div class = "row">
  <div class = "col-md-6">
**`qgrams()` 함수**

```{r ngram-distance-qgrams}
calc_mean <- function(x){
  return(1 - mean(x == 0))
}

apply(carey,1, calc_mean)
```


  </div>
  <div class = "col-md-6">
**`stringdist()` 함수**

```{r ngram-distance-stringdist}
stringdist(answer, query, method = "qgram", q=2)
```

  </div>
</div>




